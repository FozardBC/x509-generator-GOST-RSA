<!DOCTYPE html>
<html>
<head>
    <title>–ê–ú–ò–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤</title>
    <link rel="stylesheet" href="/static/style.css">

    <!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ -->
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        #spinner div {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ */
        .multiselect-container {
            position: relative;
        }
        
        .multiselect-display {
            border: 1px solid #ccc;
            padding: 8px 12px;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            min-height: 40px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .multiselect-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .multiselect-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .multiselect-option:hover {
            background: #f5f5f5;
        }
        
        .multiselect-option.selected {
            background: #e3f2fd;
        }
        
        .selected-tag {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
        }
        
        .selected-tag .remove {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .placeholder {
            color: #999;
        }
        
        .multiselect-open .multiselect-dropdown {
            display: block;
        }
        
        .multiselect-open .multiselect-display {
            border-radius: 4px 4px 0 0;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ layout */
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .form-container {
            flex: 1;
        }
        
        .download-container {
            flex: 0 0 300px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .download-container h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .cert-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            margin-bottom: 15px;
        }
        
        .cert-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .cert-item:hover {
            background: #f5f5f5;
        }
        
        .cert-item.selected {
            background: #e3f2fd;
            border-left: 3px solid #3498db;
        }
        
        .cert-item:last-child {
            border-bottom: none;
        }
        
        .cert-name {
            font-weight: bold;
            color: #333;
        }
        
        .cert-details {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .download-btn {
            width: 100%;
            padding: 12px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .download-btn:hover {
            background: #219a52;
        }
        
        .download-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .no-certs {
            padding: 20px;
            text-align: center;
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
        <div class="container">
            <div class="signature">
                <img src="/static/logo.png" alt="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å" style="margin-bottom: 20px; margin-left: 40px;">
            </div>
            
            <form action="/generate" method="post">
                <div class="form-group">
                    <label for="commonName">Common Name (–∏–º—è):</label>
                    <input type="text" id="commonName" name="commonName" required="">
                </div>
                
                <div class="form-group">
                    <label for="organization">Organization:</label>
                    <input type="text" id="organization" name="organization" value="Amicon">
                </div>

                <div class="form-group">
                    <label for="organizationUnit">Organization Unit:</label>
                    <input type="text" id="organizationUnit" name="organizationUnit" value="Test">
                </div>
                
                <div class="form-group">
                    <label for="country">Country:</label>
                    <input type="text" id="country" name="country" value="RU" maxlength="2">
                </div>

                <div class="form-group">
                    <label for="locality">Locality:</label>
                    <input type="text" id="locality" name="locality" value="Moscow" >
                </div>

                <div class="form-group">
                    <label for="province">Province:</label>
                    <input type="text" id="province" name="province" value="MSK" >
                </div>

                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="text" id="email" name="email" value="info@amicon.ru" >
                </div>
                               
                
                <div class="form-group">
                    <label for="liveTime">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</label>
                    <select id="liveTime" name="liveTime">
                        <option value="1year">–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ 1 –≥–æ–¥</option>
                        <option value="1day">–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ 1 –¥–µ–Ω—å</option>
                        <option value="future1m">–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –Ω–∞—Å—Ç—É–ø–∏—Ç —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü</option>
                        <option value="future1d">–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –Ω–∞—Å—Ç—É–ø–∏—Ç –∑–∞–≤—Ç—Ä–∞</option>
                        <option value="future1h">–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –Ω–∞—Å—Ç—É–ø–∏—Ç —á–µ—Ä–µ–∑ —á–∞—Å</option>
                        <option value="overdue">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π</option>
                    </select>
                </div>

                <div class="form-group">
                   
                    <!-- –ß–µ–∫–±–æ–∫—Å –∏ —Ç–µ–∫—Å—Ç –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
                    <div class="checkbox-inline">
                        <input type="checkbox" id="utcCheckbox" name="utc" value="1" checked="">
                        <label for="utcCheckbox">–í—Ä–µ–º—è –ø–æ UTC (GMT)</label>
                        <span class="help-icon" title="–ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ, —Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤—Ä–µ–º—è –ø–æ –ú–°–ö" style="margin-top: 0;margin-left: 0;">? </span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="keyType">–¢–∏–ø –∫–ª—é—á–∞:</label>
                    <select id="keyType" name="keyType">
                        <option value="rsa2048">RSA 2048</option>
                        <option value="rsa4096">RSA 4096</option>
                        <option value="GOST2012256">GOST2012(256)</option>
                        <option value="GOST2012512">GOST2012(512)</option>
                    </select>
                    <small class="form-text text-muted" style="color: #e74c3c;text-align: center; font-weight: bold; font-size: 0.875em; margin-top: 4px; display: block;">
        ‚ö†Ô∏è –í —Å–≤—è–∑–∏ —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ openssl gost engine - —Ç–∏–ø –∫–ª—é—á–∞ RSA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –ì–û–°–¢–æ–≤—ã–º –£–¶, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.
    </small>
                </div>
                
                <!-- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ -->
                <div class="form-group">
                    <label>–¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:</label>
                    <div class="multiselect-container" id="certTypeMultiselect">
                        <div class="multiselect-display" id="certTypeDisplay">
                            <span class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤...</span>
                        </div>
                        <div class="multiselect-dropdown" id="certTypeDropdown">
                            <div class="multiselect-option" data-value="client">–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π</div>
                            <div class="multiselect-option" data-value="server">–°–µ—Ä–≤–µ—Ä–Ω—ã–π</div>
                            <div class="multiselect-option" data-value="email">Email</div>
                            <div class="multiselect-option" data-value="empty">–ü—É—Å—Ç–æ–µ</div>
                        </div>
                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
                        <input type="hidden" id="certType" name="certType" value="">
                    </div>
                </div>

                <!-- <div class="form-group">
                    <label for="caName">–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä:</label>
                    <select id="caName" name="caName">
                        <option value="org1-2048">org1 (RSA 2048)</option>
                        <option value="org1-4096">org1 (RSA 4096)</option>
                    </select>
                </div> -->

                <div class="form-group">
                    <label for="caName">–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä:</label>
                    <div style="align-items: center; gap: 8px;">
                        <select id="caName" name="caName">
                            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                        </select>
                        <button type="button" id="refreshCA" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –£–¶" style="background-color: #6d39e7; margin-top: 14px;">
                            üîÑ
                          
                        </button>
                    </div>
                </div>  

                <div class="form-group">
                    <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤</label>
                    <input type="number" id="count" name="count" value="1" min="1" max="100">
                </div>

                <div class="form-group">
                <button type="button" id="toggleAdvanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>

                <!-- –°–∫—Ä—ã—Ç—ã–π –±–ª–æ–∫ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ -->
                <div id="advanced-settings" style="display: none; margin-top: 20px; margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px;">
                <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>

                    <div class="form-group">
                        <label for="crlDistributionPoints">CRL Distribution Points:</label>
                        <input type="text" id="crlDistributionPoints" name="crlDistributionPoints" value=" "> 
                        <div class="help-text">–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ - –≤–≤–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –ë–ï–ó –ü–†–û–ë–ï–õ–û–í</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="authorityInfoAccess">Authority Info Access:</label>
                        <input type="text" id="authorityInfoAccess" name="authorityInfoAccess" value=" ">
                        <div class="help-text">–ü—Ä–∏–º–µ—Ä: OCSP;http://192.168.28.4,CAIssuers;http://192.168.28.2<br>–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ - –≤–≤–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –ë–ï–ó –ü–†–û–ë–ï–õ–û–í</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="serial">Serial Number:</label>
                        <input type="text" id="serial" name="serial" inputmode="numeric" pattern="[0-9]*" value="0" title="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                        <div class="help-text">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å 0 ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∞–º</div>
                    </div>

                    <div class="form-group">
                        <label for="upn">User Principal Name:</label>
                        <input type="text" id="upn" name="upn" value=" ">
                        <div class="help-text">–§–æ—Ä–º–∞—Ç: user@domain.com –∏–ª–∏ user@domain.local</div>
                    </div>

                  
                </div>

                <button type="submit">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</button>
            </form>
            
            {{if .Error}}
            <div class="error">{{.Error}}</div>
            {{end}}
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ -->
        <div class="containerDOWNLOAD">
    <h2>–°–∫–∞—á–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –£–¶</h2>

    <div class="form-group">
        <label for="downloadCaName">–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä:</label>
        <div style="display: flex; align-items: center; gap: 8px;">
            <select class="select" id="downloadCaName" name="caName">
                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
            </select>
            <button type="button" id="refreshDownloadCA" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –£–¶" style="background-color: #6d39e7;width: 50px; margin-top: 20px;">üîÑ</button>
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
        <form id="downloadForm" action="/download/cert" method="get" style="display: inline;">
            <input type="hidden" id="downloadFormCaInput" name="caName">
            <button type="submit" class="button" style="margin-bottom: 0;">–°–∫–∞—á–∞—Ç—å</button>
        </form>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
        <button type="button" id="openUploadModal" class="button" style="background: #6d39e7; margin-bottom: 0;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –£–¶</button>


        <h2>–°–æ–∑–¥–∞—Ç—å PKCS12 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (.pfx)</h2>

        <button type="button" id="createPfx" class="button" style="background: #6d39e7; margin-bottom: 0;">–°–æ–∑–¥–∞—Ç—å</button>
    </div>
        </div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CA -->
        <div id="uploadModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ –¶–µ–Ω—Ç—Ä–∞</h3>
                    <span class="close">√ó</span>
                </div>
                <div class="modal-body">
                    <!-- –ë–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ -->
                    <div id="uploadError" class="error-message" style="display: none;"></div>
                    
                    <form id="uploadCAForm" action="/upload/ca" method="post" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="certFile">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (.cer/.crt):</label>
                            <input type="file" id="certFile" name="certFile" accept=".cer,.crt" required="">
                            <div id="certFileStatus" class="file-status"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="keyFile">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (.key):</label>
                            <input type="file" id="keyFile" name="keyFile" accept=".key" required="">
                            <div id="keyFileStatus" class="file-status"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="caName">–ò–º—è –£–¶:</label>
                            <input type="text" id="caName" name="caName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞" required="">
                            <small class="form-text text-muted" style="color: #e74c3c;text-align: center; font-weight: bold; font-size: 0.875em; margin-top: 4px; display: block;">
                ‚ö†Ô∏è –ò–º—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –£–¶ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –≤–∏–¥ <br>
                [–ê–õ–ì–û–†–ò–¢–ú-–ù–ê–ó–í–ê–ù–ò–ï-–î–õ–ò–ù–ê–ö–õ–Æ–ß–ê]<br>
                –ù–∞–ø—Ä–∏–º–µ—Ä "rsa-org1-2048".
            </small>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" id="cancelUpload" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" id="submitUpload" class="btn" disabled="">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


















        
     
    </div>

    <!-- –°–ø–∏–Ω–Ω–µ—Ä (–∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏) -->
    <div id="spinner">
        <div></div>
    </div>
















<style>

 
   [data-tooltip] {
    position: relative; /* –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */ 
   }
   [data-tooltip]::after {
    content: attr(data-tooltip); /* –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç */
    position: absolute; /* –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
    width: 300px; /* –®–∏—Ä–∏–Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
    left: 0; top: 0; /* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
    background: #3989c9; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ */
    color: #fff; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
    padding: 0.5em; /* –ü–æ–ª—è –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—Å—Ç–∞ */
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); /* –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–Ω–∏ */
    pointer-events: none; /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ */
    opacity: 0; /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–µ–≤–∏–¥–∏–º–∞ */
    transition: 1s; /* –í—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
   } 
   [data-tooltip]:hover::after {
    opacity: 1; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É */
    top: 2em; /* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
   }

   .help-text {
    margin-top: 5px;
    font-size: 12px;
    color: #666;
    background-color: #f9f9f9;
    padding: 8px;
    border-radius: 4px;
    border-left: 3px solid #007cba;
    user-select: text;
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    cursor: text;
    line-height: 1.4;
}
 
    .modal {
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: white;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }

    .modal-header h3 {
        margin: 0;
        color: #333;
    }

    .close {
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        color: #999;
    }

    .close:hover {
        color: #333;
    }

    .modal-body {
        padding: 20px;
    }

    .file-status {
        font-size: 12px;
        margin-top: 5px;
        min-height: 15px;
    }

    .file-status.success {
        color: #27ae60;
    }

    .file-status.error {
        color: #e74c3c;
    }

    .modal-actions {
        display: flex;
        gap: 20px;
        justify-content: flex-end;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    .btn-secondary {
        background: #95a5a6;
        color: white;
    }

    .btn-secondary:hover {
        background: #7f8c8d;
    }

    .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        color: white;
    }

    #submitUpload {
        background: #27ae60;
        color: white;
    }

    #submitUpload:not(:disabled):hover {
        background: #219a52;
    }

    input[type="file"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 5px;
    }

    input[type="text"] {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-top: 5px;
        box-sizing: border-box;
    }
</style>

<script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const uploadModal = document.getElementById('uploadModal');
    const openUploadModalBtn = document.getElementById('openUploadModal');
    const closeModalBtn = document.querySelector('.close');
    const cancelUploadBtn = document.getElementById('cancelUpload');
    const uploadCAForm = document.getElementById('uploadCAForm');
    const submitUploadBtn = document.getElementById('submitUpload');
    const certFileInput = document.getElementById('certFile');
    const keyFileInput = document.getElementById('keyFile');
    const certFileStatus = document.getElementById('certFileStatus');
    const keyFileStatus = document.getElementById('keyFileStatus');
    const caNameInput = document.getElementById('caName');
    const uploadError = document.getElementById('uploadError');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
    function showError(message) {
        uploadError.textContent = message;
        uploadError.style.display = 'block';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –æ—à–∏–±–∫–∏
    function hideError() {
        uploadError.style.display = 'none';
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    openUploadModalBtn.addEventListener('click', function() {
        uploadModal.style.display = 'flex';
        resetForm();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function closeModal() {
        uploadModal.style.display = 'none';
        resetForm();
    }

    closeModalBtn.addEventListener('click', closeModal);
    cancelUploadBtn.addEventListener('click', closeModal);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    window.addEventListener('click', function(event) {
        if (event.target === uploadModal) {
            closeModal();
        }
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
    function validateFiles() {
        const certFile = certFileInput.files[0];
        const keyFile = keyFileInput.files[0];
        const caName = caNameInput.value.trim();

        let certValid = false;
        let keyValid = false;

        // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
        hideError();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
        if (certFile) {
            const certExt = certFile.name.toLowerCase().split('.').pop();
            if (certExt === 'cer' || certExt === 'crt') {
                certFileStatus.textContent = '‚úì –§–∞–π–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤—ã–±—Ä–∞–Ω';
                certFileStatus.className = 'file-status success';
                certValid = true;
            } else {
                certFileStatus.textContent = '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .cer –∏–ª–∏ .crt';
                certFileStatus.className = 'file-status error';
                certValid = false;
            }
        } else {
            certFileStatus.textContent = '';
            certValid = false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞
        if (keyFile) {
            const keyExt = keyFile.name.toLowerCase().split('.').pop();
            if (keyExt === 'key') {
                keyFileStatus.textContent = '‚úì –§–∞–π–ª –∫–ª—é—á–∞ –≤—ã–±—Ä–∞–Ω';
                keyFileStatus.className = 'file-status success';
                keyValid = true;
            } else {
                keyFileStatus.textContent = '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .key';
                keyFileStatus.className = 'file-status error';
                keyValid = false;
            }
        } else {
            keyFileStatus.textContent = '';
            keyValid = false;
        }

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        submitUploadBtn.disabled = !(certValid && keyValid && caName.length > 0);
    }

    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    function resetForm() {
        uploadCAForm.reset();
        certFileStatus.textContent = '';
        keyFileStatus.textContent = '';
        certFileStatus.className = 'file-status';
        keyFileStatus.className = 'file-status';
        submitUploadBtn.disabled = true;
        hideError();
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
    certFileInput.addEventListener('change', validateFiles);
    keyFileInput.addEventListener('change', validateFiles);
    caNameInput.addEventListener('input', validateFiles);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    uploadCAForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
        document.getElementById('spinner').style.display = 'flex';
        submitUploadBtn.disabled = true;
        submitUploadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        hideError();

        fetch('/upload/ca', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => {
                    throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                showSuccess('–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                setTimeout(() => {
                    closeModal();
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –£–¶ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                    loadCAs();
                }, 1500);
            } else {
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
        })
        .finally(() => {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            document.getElementById('spinner').style.display = 'none';
            submitUploadBtn.disabled = false;
            submitUploadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å';
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    function showSuccess(message) {
        uploadError.style.background = '#e8f5e8';
        uploadError.style.border = '1px solid #c3e6c3';
        uploadError.style.color = '#155724';
        uploadError.textContent = message;
        uploadError.style.display = 'block';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –£–¶
    // function loadCAs() {
    //     fetch('/update/ca')
    //         .then(response => {
    //             if (!response.ok) {
    //                 throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –£–¶');
    //             }
    //             return response.json();
    //         })
    //         .then(data => {
    //             const select = document.getElementById('downloadCaName');
    //             select.innerHTML = '';
                
    //             if (!data.cas || data.cas.length === 0) {
    //                 select.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –£–¶</option>';
    //                 return;
    //             }
                
    //             data.cas.forEach(ca => {
    //                 const option = document.createElement('option');
    //                 option.value = ca.name;
    //                 option.textContent = ca.displayName || ca.name;
    //                 select.appendChild(option);
    //             });
    //         })
    //         .catch(error => {
    //             console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –£–¶:', error);
    //             document.getElementById('downloadCaName').innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
    //         });
    // }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        loadCAs();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –£–¶
        document.getElementById('refreshDownloadCA').addEventListener('click', function() {
            loadCAs();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        document.getElementById('downloadForm').addEventListener('submit', function(e) {
            const selectedCA = document.getElementById('downloadCaName').value;
            if (!selectedCA) {
                e.preventDefault();
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π –¶–µ–Ω—Ç—Ä');
                return;
            }
            document.getElementById('downloadFormCaInput').value = selectedCA;
        });
    });
</script>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –£–¶ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–µ–ª–µ–∫—Ç–∞
    async function loadCAListInto(selectId) {
        const select = document.getElementById(selectId);
        const button = selectId === 'caName' 
            ? document.getElementById('refreshCA') 
            : document.getElementById('refreshDownloadCA');

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (button) {
            button.disabled = true;
            button.textContent = '‚è≥';
        }

        select.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>';

        try {
            const response = await fetch('/update/ca');
            if (!response.ok) throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
            const data = await response.json();

            select.innerHTML = '';

            if (data.certificates && data.certificates.length > 0) {
                data.certificates.forEach(ca => {
                    const option = document.createElement('option');
                    option.value = ca;

                    // –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏
                    let label = ca;
                    if (ca.includes('-2048')) {
                        label = ca.replace('-2048', ' (RSA 2048)');
                    } else if (ca.includes('-4096')) {
                        label = ca.replace('-4096', ' (RSA 4096)');
                    }
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —à–∞–±–ª–æ–Ω—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

                    option.textContent = label;
                    select.appendChild(option);
                });
            } else {
                const opt = document.createElement('option');
                opt.value = '';
                opt.textContent = '–ù–µ—Ç –£–¶';
                select.appendChild(opt);
            }
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –£–¶:', err);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞</option>';
        } finally {
            if (button) {
                button.disabled = false;
                button.textContent = 'üîÑ';
            }
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
    document.addEventListener('DOMContentLoaded', () => {
        const downloadSelect = document.getElementById('downloadCaName');
        const hiddenInput = document.getElementById('downloadFormCaInput');

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadCAListInto('downloadCaName');

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≤—ã–±–æ—Ä —Å —Ñ–æ—Ä–º–æ–π
        downloadSelect.addEventListener('change', () => {
            hiddenInput.value = downloadSelect.value;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        document.getElementById('refreshDownloadCA').addEventListener('click', () => {
            loadCAListInto('downloadCaName');
            // –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ
            hiddenInput.value = '';
        });
    });
</script>

    <script>
    async function loadCAList() {
        const select = document.getElementById('caName');
        const button = document.getElementById('refreshCA');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        select.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>';
        button.disabled = true;
        button.textContent = '‚è≥';

        try {
            const response = await fetch('/update/ca');
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –£–¶');
            }
            const data = await response.json();

            // –û—á–∏—â–∞–µ–º —Å–µ–ª–µ–∫—Ç
            select.innerHTML = '';

            if (data.certificates && data.certificates.length > 0) {
                data.certificates.forEach(ca => {
                    const option = document.createElement('option');
                    option.value = ca;

                    // –ü–æ–ø—ã—Ç–∞–µ–º—Å—è –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–º—è (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ)
                    let label = ca;
                    if (ca.includes('-2048')) {
                        label = ca.replace('-2048', ' (RSA 2048)');
                    } else if (ca.includes('-4096')) {
                        label = ca.replace('-4096', ' (RSA 4096)');
                    }
                    // –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

                    option.textContent = label;
                    select.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –£–¶';
                select.appendChild(option);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
        } finally {
            button.disabled = false;
            button.textContent = 'üîÑ';
        }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', loadCAList);

    // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
    document.getElementById('refreshCA').addEventListener('click', loadCAList);
</script>

    <script>
    document.getElementById('toggleAdvanced').addEventListener('click', function() {
        const advanced = document.getElementById('advanced-settings');
        if (advanced.style.display === 'none') {
            advanced.style.display = 'block';
            this.textContent = '–°–∫—Ä—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
        } else {
            advanced.style.display = 'none';
            this.textContent = '–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
        }
    });
</script>

<script>
    const downloadSelect = document.getElementById('downloadCaName');
    const downloadForm = document.getElementById('downloadForm');

    // –û–±–Ω–æ–≤–ª—è–µ–º action —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
    downloadSelect.addEventListener('change', function() {
        const selectedValue = this.value;
        downloadForm.action = `/download/ca/${selectedValue}`;
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        const initialValue = downloadSelect.value;
        downloadForm.action = `/download/ca/${initialValue}`;
    });
</script>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
    <script>
        // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Ç–∏–ø–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
        const multiselect = document.getElementById('certTypeMultiselect');
        const display = document.getElementById('certTypeDisplay');
        const dropdown = document.getElementById('certTypeDropdown');
        const hiddenInput = document.getElementById('certType');
        const options = dropdown.querySelectorAll('.multiselect-option');
        
        let selectedValues = [];
        let selectedCert = null;
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ dropdown
        display.addEventListener('click', function(e) {
            e.stopPropagation();
            multiselect.classList.toggle('multiselect-open');
        });
        
        // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏
        options.forEach(option => {
            option.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const text = this.textContent;
                
                if (selectedValues.includes(value)) {
                    // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                    selectedValues = selectedValues.filter(v => v !== value);
                    this.classList.remove('selected');
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                    selectedValues.push(value);
                    this.classList.add('selected');
                }
                
                updateDisplay();
                updateHiddenInput();
            });
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function() {
            multiselect.classList.remove('multiselect-open');
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        function updateDisplay() {
            if (selectedValues.length === 0) {
                display.innerHTML = '<span class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤...</span>';
                return;
            }
            
            display.innerHTML = '';
            selectedValues.forEach(value => {
                const option = Array.from(options).find(opt => opt.getAttribute('data-value') === value);
                const text = option ? option.textContent : value;
                
                const tag = document.createElement('span');
                tag.className = 'selected-tag';
                tag.innerHTML = `${text}<span class="remove" data-value="${value}">√ó</span>`;
                display.appendChild(tag);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
            display.querySelectorAll('.remove').forEach(removeBtn => {
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const valueToRemove = this.getAttribute('data-value');
                    selectedValues = selectedValues.filter(v => v !== valueToRemove);
                    
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –æ–ø—Ü–∏–∏
                    const optionToDeselect = Array.from(options).find(opt => 
                        opt.getAttribute('data-value') === valueToRemove
                    );
                    if (optionToDeselect) {
                        optionToDeselect.classList.remove('selected');
                    }
                    
                    updateDisplay();
                    updateHiddenInput();
                });
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function updateHiddenInput() {
            hiddenInput.value = selectedValues.join(',');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
        function loadCertificates() {
            fetch('/api/certificates')
                .then(response => response.json())
                .then(certificates => {
                    const certList = document.getElementById('certList');
                    
                    if (certificates.length === 0) {
                        certList.innerHTML = '<div class="no-certs">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                        return;
                    }
                    
                    certList.innerHTML = '';
                    certificates.forEach(cert => {
                        const certItem = document.createElement('div');
                        certItem.className = 'cert-item';
                        certItem.innerHTML = `
                            <div class="cert-name">${cert.name}</div>
                            <div class="cert-details">
                                –¢–∏–ø: ${cert.type} | –°–æ–∑–¥–∞–Ω: ${cert.created}
                            </div>
                        `;
                        
                        certItem.addEventListener('click', function() {
                            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                            document.querySelectorAll('.cert-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            
                            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                            this.classList.add('selected');
                            selectedCert = cert.name;
                            
                            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                            document.getElementById('downloadBtn').disabled = false;
                        });
                        
                        certList.appendChild(certItem);
                    });
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:', error);
                    document.getElementById('certList').innerHTML = 
                        '<div class="no-certs">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞</div>';
                });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        document.getElementById('downloadBtn').addEventListener('click', function() {
            if (selectedCert) {
                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const downloadUrl = `/download/ca/${encodeURIComponent(selectedCert)}`;
                window.open(downloadUrl, '_blank');
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.querySelector('form').addEventListener('submit', function(e) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
            if (selectedValues.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞');
                return;
            }
            
            document.getElementById('spinner').style.display = 'flex';
            const btn = document.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
            
            // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
            setTimeout(() => {
                loadCertificates();
            }, 2000);
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadCertificates();
        });
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const keyTypeSelect = document.getElementById('keyType');
        const liveTimeSelect = document.getElementById('liveTime');

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
        const allOptions = Array.from(liveTimeSelect.querySelectorAll('option'));

        function updateLiveTimeOptions() {
            const selectedKeyType = keyTypeSelect.value;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª—é—á –ì–û–°–¢–æ–º
            const isGost = selectedKeyType === 'GOST2012256' || selectedKeyType === 'GOST2012512';

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏
            liveTimeSelect.innerHTML = '';

            // –§–∏–ª—å—Ç—Ä—É–µ–º –æ–ø—Ü–∏–∏
            allOptions.forEach(option => {
                const value = option.value;
                if (!isGost) {
                    // –î–ª—è RSA ‚Äî –≤—Å–µ –æ–ø—Ü–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
                    liveTimeSelect.appendChild(option.cloneNode(true));
                } else {
                    // –î–ª—è –ì–û–°–¢ ‚Äî —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ
                    if (['1year', '1day', 'overdue'].includes(value)) {
                        liveTimeSelect.appendChild(option.cloneNode(true));
                    }
                }
            });

            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π
            if (!Array.from(liveTimeSelect.options).some(opt => opt.value === liveTimeSelect.value)) {
                liveTimeSelect.selectedIndex = 0;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateLiveTimeOptions();

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –∫–ª—é—á–∞
        keyTypeSelect.addEventListener('change', updateLiveTimeOptions);
    });
</script>

</body>
</html>