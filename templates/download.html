<!DOCTYPE html>
<html>
<head>
    <title>Сертификат готов</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>✅ Сертификат успешно создан!</h1>
        <h1>Сгенерировано <strong>{{.Count}} сертификатов</strong></h1>
        <p>Common Name: <strong>{{.CommonName}}</strong></p>
        

        <form action="/download/{{.ReqID}}" method="get" style="display: inline;">
            <input type="hidden" name="caName" value="{{.SelectedCA}}">
            <input type="hidden" name="commonName" value="{{.CommonName}}">
            <button type="submit" class="btn">Скачать сертификат (.crt/.key)</button>
        </form>

        <form action="/pfx/{{.ReqID}}" method="get" style="display: inline;">
            <input type="hidden" name="caName" value="{{.SelectedCA}}">
            <input type="hidden" name="commonName" value="{{.CommonName}}">
            <input type="hidden" name="keyType" value="{{.keyType}}">
            
            <!-- Кнопка "Скачать контейнер" — теперь не форма, а кнопка -->
            <button type="button" class="btn" id="openPfxDownload">Скачать контейнер (.pfx)</button>

            <!-- Модальное окно для ввода пароля -->
            <div id="passwordModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
                <div style="background:white; padding:20px; border-radius:8px; width:300px; box-shadow:0 4px 6px rgba(0,0,0,0.1);">
                    <h3>Введите пароль для контейнера</h3>
                    <input type="password" id="pfxPasswordInput" placeholder="Минимум 4 символа" minlength="4" style="width:100%; padding:8px; margin:10px 0; box-sizing:border-box;" required>
                    <div style="text-align:right; margin-top:10px;">
                        <button type="button" id="cancelPfxPassword" style="background:#95a5a6; color:white; border:none; padding:6px 12px; border-radius:4px; margin-right:8px;">Отмена</button>
                        <button type="button" id="confirmPfxPassword" style="background:#27ae60; color:white; border:none; padding:6px 12px; border-radius:4px;">OK</button>
                    </div>
                </div>
            </div>
        </form>





       
    </div>

    

    <div class="container">
  
 <!-- Кнопка "Назад на главную" -->
       <form action="/" method="get" style="display: inline;">
    <button type="submit" class="btn">Вернуться на главную</button>
</form>
    </div>
</body>
</html>

<script>
document.getElementById('openPfxDownload').addEventListener('click', function() {
    document.getElementById('passwordModal').style.display = 'flex';
    document.getElementById('pfxPasswordInput').value = '';
});

document.getElementById('cancelPfxPassword').addEventListener('click', function() {
    document.getElementById('passwordModal').style.display = 'none';
});

document.getElementById('confirmPfxPassword').addEventListener('click', function() {
    const password = document.getElementById('pfxPasswordInput').value;
    if (password.length < 4) {
        alert('Пароль должен содержать не менее 4 символов.');
        return;
    }

    // Скрываем модальное окно
    document.getElementById('passwordModal').style.display = 'none';

    // Создаём форму динамически
    const form = document.createElement('form');
    form.method = 'GET';
    form.action = '/pfx/{{.ReqID}}';

    // Добавляем скрытые поля
    const fields = [
        { name: 'caName', value: '{{.SelectedCA}}' },
        { name: 'commonName', value: '{{.CommonName}}' },
        { name: 'keyType', value: '{{.KeyType}}' },
        { name: 'password', value: password }
    ];

    fields.forEach(field => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = field.name;
        input.value = field.value;
        form.appendChild(input);
    });

    // Добавляем форму в body и отправляем
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
});
</script>